<!-- Add this code to templates/servers/details.html -->
<!-- This should be the entire content of the file -->

{% extends "base.html" %}

{% block title %}{{ server.name }} - Server Details{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{{ server.name }} <span class="badge {% if server.status == 'active' %}bg-success{% elif server.status == 'inactive' %}bg-danger{% else %}bg-warning text-dark{% endif %}">
            {{ server.status|title }}
        </span></h1>
        <div class="btn-group">
            <a href="{{ url_for('edit_server', server_id=server.id) }}" class="btn btn-primary">
                <i class="bi bi-pencil"></i> Edit
            </a>
            <a href="{{ url_for('servers') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Servers
            </a>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-4">
            <!-- Server Information Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Server Information</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th>ID</th>
                                <td>{{ server.id }}</td>
                            </tr>
                            <tr>
                                <th>Endpoint</th>
                                <td>{{ server.endpoint }}:{{ server.port }}</td>
                            </tr>
                            <tr>
                                <th>Internal IP</th>
                                <td>{{ server.address }}</td>
                            </tr>
                            <tr>
                                <th>Geolocation</th>
                                <td>{{ server.geolocation_name or 'Unknown' }}</td>
                            </tr>
                            <tr>
                                <th>Maximum Peers</th>
                                <td>{{ server.max_peers }}</td>
                            </tr>
                            <tr>
                                <th>Public Key</th>
                                <td>
                                    <div class="input-group">
                                        <input type="text" class="form-control form-control-sm" value="{{ server.public_key }}" readonly>
                                        <button class="btn btn-sm btn-outline-secondary copy-btn" type="button" data-copy="{{ server.public_key }}">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>API Key</th>
                                <td>
                                    <div class="input-group">
                                        <input type="text" class="form-control form-control-sm" value="{{ server.api_key }}" readonly>
                                        <button class="btn btn-sm btn-outline-secondary copy-btn" type="button" data-copy="{{ server.api_key }}">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Server Actions Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Server Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('server_details', server_id=server.id, hours=6) }}" class="btn btn-outline-primary {% if hours == 6 %}active{% endif %}">
                            Last 6 Hours
                        </a>
                        <a href="{{ url_for('server_details', server_id=server.id, hours=24) }}" class="btn btn-outline-primary {% if hours == 24 %}active{% endif %}">
                            Last 24 Hours
                        </a>
                        <a href="{{ url_for('server_details', server_id=server.id, hours=72) }}" class="btn btn-outline-primary {% if hours == 72 %}active{% endif %}">
                            Last 3 Days
                        </a>
                        <a href="{{ url_for('server_details', server_id=server.id, hours=168) }}" class="btn btn-outline-primary {% if hours == 168 %}active{% endif %}">
                            Last Week
                        </a>
                        <hr>
                        <form method="POST" action="{{ url_for('server_action', server_id=server.id, action='restart') }}" class="d-grid">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-warning" onclick="return confirm('Are you sure you want to restart the WireGuard service?')">
                                <i class="bi bi-arrow-clockwise"></i> Restart WireGuard
                            </button>
                        </form>
                        <form method="POST" action="{{ url_for('server_action', server_id=server.id, action='toggle_status') }}" class="d-grid">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn {% if server.status == 'active' %}btn-danger{% else %}btn-success{% endif %}">
                                {% if server.status == 'active' %}
                                <i class="bi bi-pause-circle"></i> Deactivate Server
                                {% else %}
                                <i class="bi bi-play-circle"></i> Activate Server
                                {% endif %}
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-8">
            <!-- Current Metrics Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Current Metrics</h5>
                </div>
                <div class="card-body">
                    {% if metrics and metrics.current %}
                    <div class="row">
                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card h-100 bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">Connected Peers</h6>
                                    <h2>{{ metrics.current.peers_count|default(0) }}</h2>
                                    <p class="text-muted">Max: {{ server.max_peers }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card h-100 bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">CPU Usage</h6>
                                    <h2>{{ metrics.current.cpu_usage|default(0) }}%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar {% if metrics.current.cpu_usage > 80 %}bg-danger{% elif metrics.current.cpu_usage > 60 %}bg-warning{% else %}bg-success{% endif %}" 
                                             style="width: {{ metrics.current.cpu_usage|default(0) }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card h-100 bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">Memory Usage</h6>
                                    <h2>{{ metrics.current.memory_usage|default(0) }}%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar {% if metrics.current.memory_usage > 80 %}bg-danger{% elif metrics.current.memory_usage > 60 %}bg-warning{% else %}bg-success{% endif %}" 
                                             style="width: {{ metrics.current.memory_usage|default(0) }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card h-100 bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">Avg. Latency</h6>
                                    <h2>{{ metrics.current.avg_latency|default(0)|round(1) }}ms</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar {% if metrics.current.avg_latency > 100 %}bg-danger{% elif metrics.current.avg_latency > 50 %}bg-warning{% else %}bg-success{% endif %}" 
                                             style="width: {{ (metrics.current.avg_latency|default(0) / 2)|min(100) }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card h-100 bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">Packet Loss</h6>
                                    <h2>{{ metrics.current.avg_packet_loss|default(0)|round(2) }}%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar {% if metrics.current.avg_packet_loss > 5 %}bg-danger{% elif metrics.current.avg_packet_loss > 1 %}bg-warning{% else %}bg-success{% endif %}" 
                                             style="width: {{ (metrics.current.avg_packet_loss|default(0) * 10)|min(100) }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card h-100 bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">Server Load</h6>
                                    <h2>{{ metrics.current.load|default(0)|round(2) }}</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar {% if metrics.current.load > 2 %}bg-danger{% elif metrics.current.load > 1 %}bg-warning{% else %}bg-success{% endif %}" 
                                             style="width: {{ (metrics.current.load|default(0) * 33.3)|min(100) }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        No current metrics available for this server.
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Metrics Chart Tabs -->
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="serverChartTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="latency-tab" data-bs-toggle="tab" data-bs-target="#latency" type="button" role="tab" aria-controls="latency" aria-selected="true">
                                Latency
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="packet-loss-tab" data-bs-toggle="tab" data-bs-target="#packet-loss" type="button" role="tab" aria-controls="packet-loss" aria-selected="false">
                                Packet Loss
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="resources-tab" data-bs-toggle="tab" data-bs-target="#resources" type="button" role="tab" aria-controls="resources" aria-selected="false">
                                Resources
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="interactive-tab" data-bs-toggle="tab" data-bs-target="#interactive" type="button" role="tab" aria-controls="interactive" aria-selected="false">
                                Interactive Dashboard
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="serverChartTabsContent">
                        <div class="tab-pane fade show active" id="latency" role="tabpanel" aria-labelledby="latency-tab">
                            {% if charts.latency %}
                                <img src="data:image/png;base64,{{ charts.latency }}" class="img-fluid" alt="Latency Chart">
                            {% else %}
                                <div class="alert alert-info">No latency data available.</div>
                            {% endif %}
                        </div>
                        <div class="tab-pane fade" id="packet-loss" role="tabpanel" aria-labelledby="packet-loss-tab">
                            {% if charts.packet_loss %}
                                <img src="data:image/png;base64,{{ charts.packet_loss }}" class="img-fluid" alt="Packet Loss Chart">
                            {% else %}
                                <div class="alert alert-info">No packet loss data available.</div>
                            {% endif %}
                        </div>
                        <div class="tab-pane fade" id="resources" role="tabpanel" aria-labelledby="resources-tab">
                            {% if charts.resources %}
                                <img src="data:image/png;base64,{{ charts.resources }}" class="img-fluid" alt="Resource Usage Chart">
                            {% else %}
                                <div class="alert alert-info">No resource usage data available.</div>
                            {% endif %}
                        </div>
                        <div class="tab-pane fade" id="interactive" role="tabpanel" aria-labelledby="interactive-tab">
                            {% if interactive_chart %}
                                {{ interactive_chart|safe }}
                            {% else %}
                                <div class="alert alert-info">Interactive dashboard not available. This feature requires Plotly support.</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}