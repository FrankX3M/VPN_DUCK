{% extends "base.html" %}

{% block title %}Server Details - {{ server.name }} - VPN Duck{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-10 offset-lg-1">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2">{{ server.name }}</h1>
                <div>
                    <a href="{{ url_for('servers.edit', server_id=server.id) }}" class="btn btn-primary me-2">
                        <i class="bi bi-pencil"></i> Edit Server
                    </a>
                    <a href="{{ url_for('servers.delete', server_id=server.id) }}" 
                       class="btn btn-danger confirm-action"
                       data-confirm="Are you sure you want to delete this server?">
                        <i class="bi bi-trash"></i> Delete
                    </a>
                </div>
            </div>
            
            <!-- Status Badge -->
            <div class="mb-4">
                <span class="badge {% if server.status == 'active' %}bg-success{% elif server.status == 'inactive' %}bg-danger{% else %}bg-warning text-dark{% endif %} p-2 fs-6">
                    <i class="bi {% if server.status == 'active' %}bi-check-circle{% elif server.status == 'inactive' %}bi-x-circle{% else %}bi-exclamation-triangle{% endif %}"></i>
                    {{ server.status|title }}
                </span>
            </div>
            
            <!-- Server Basic Info -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Basic Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Server ID:</dt>
                                <dd class="col-sm-8">{{ server.id }}</dd>
                                
                                <dt class="col-sm-4">Name:</dt>
                                <dd class="col-sm-8">{{ server.name }}</dd>
                                
                                <dt class="col-sm-4">Endpoint:</dt>
                                <dd class="col-sm-8">{{ server.endpoint }}:{{ server.port }}</dd>
                                
                                <dt class="col-sm-4">Address:</dt>
                                <dd class="col-sm-8">{{ server.address }}</dd>
                            </dl>
                        </div>
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Geolocation:</dt>
                                <dd class="col-sm-8">{{ server.geolocation_name or 'Unknown' }}</dd>
                                
                                <dt class="col-sm-4">Max Peers:</dt>
                                <dd class="col-sm-8">{{ server.max_peers or 'Unlimited' }}</dd>
                                
                                <dt class="col-sm-4">Current Peers:</dt>
                                <dd class="col-sm-8">{{ server.current_peers or '0' }}</dd>
                                
                                <dt class="col-sm-4">Status:</dt>
                                <dd class="col-sm-8">
                                    <span class="badge {% if server.status == 'active' %}bg-success{% elif server.status == 'inactive' %}bg-danger{% else %}bg-warning text-dark{% endif %}">
                                        {{ server.status|title }}
                                    </span>
                                </dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Server API Info -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Параметры API</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">API URL:</dt>
                        <dd class="col-sm-9">{{ server.api_url }}</dd>
                        
                        <dt class="col-sm-3">API Path:</dt>
                        <dd class="col-sm-9">{{ server.api_path }}</dd>
                        
                        <dt class="col-sm-3">Проверка API:</dt>
                        <dd class="col-sm-9">
                            {% if server.skip_api_check %}
                            <span class="badge bg-warning text-dark">Пропущена</span>
                            {% else %}
                            <span class="badge bg-info">Активна</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-3">API Key:</dt>
                        <dd class="col-sm-9">
                            <div class="input-group">
                                <input type="password" id="apiKeyField" class="form-control" value="{{ server.api_key }}" readonly>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" onclick="toggleApiKeyVisibility()">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary copy-btn" data-copy="{{ server.api_key }}">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </dd>
                    </dl>
                </div>
            </div>
            
            <!-- Server Public Key -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>WireGuard Configuration</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">Public Key:</dt>
                        <dd class="col-sm-9">
                            <div class="input-group">
                                <input type="text" class="form-control" value="{{ server.public_key }}" readonly>
                                <button class="btn btn-outline-secondary copy-btn" data-copy="{{ server.public_key }}">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                        </dd>
                    </dl>
                </div>
            </div>
            
            <!-- Server Statistics -->
            {% if server_stats %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Server Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Peer Statistics</h5>
                                    <p class="card-text">Active Peers: {{ server_stats.active_peers }}</p>
                                    <p class="card-text">Total Peers: {{ server_stats.total_peers }}</p>
                                    <p class="card-text">Utilization: {{ server_stats.utilization_percent }}%</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h5 class="card-title">Performance</h5>
                                    <p class="card-text">Uptime: {{ server_stats.uptime }}</p>
                                    <p class="card-text">Load Average: {{ server_stats.load_average }}</p>
                                    <p class="card-text">Memory Usage: {{ server_stats.memory_usage }}%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="d-flex justify-content-between mt-4">
                <a href="{{ url_for('servers.index') }}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Servers
                </a>
                {% if server.status == 'active' %}
                <a href="{{ url_for('servers.toggle_status', server_id=server.id, status='inactive') }}" 
                   class="btn btn-warning confirm-action"
                   data-confirm="Are you sure you want to deactivate this server?">
                    <i class="bi bi-power"></i> Deactivate Server
                </a>
                {% else %}
                <a href="{{ url_for('servers.toggle_status', server_id=server.id, status='active') }}" 
                   class="btn btn-success confirm-action"
                   data-confirm="Are you sure you want to activate this server?">
                    <i class="bi bi-power"></i> Activate Server
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function toggleApiKeyVisibility() {
    var apiKeyField = document.getElementById('apiKeyField');
    if (apiKeyField.type === 'password') {
        apiKeyField.type = 'text';
    } else {
        apiKeyField.type = 'password';
    }
}
</script>
{% endblock %}